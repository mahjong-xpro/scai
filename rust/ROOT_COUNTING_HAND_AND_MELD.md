# 根数统计：手牌加副牌有4张一样的也算根

## 问题描述

用户要求：**手牌加副牌有4张一样的也算根**

### 场景分析

1. **手牌中有1张1万，副牌中有3张1万（碰）**：
   - 手牌：1张1万
   - 副牌：3张1万（碰）
   - 总共：4张1万 → **应该算1个根**

2. **手牌中有2张1万，副牌中有2张1万（碰）**：
   - 手牌：2张1万
   - 副牌：2张1万（碰）→ 但碰只有3张，不是2张
   - 实际上：手牌2张 + 碰3张 = 5张（不是4张）

3. **手牌中有1张1万，副牌中有3张1万（碰），然后加杠**：
   - 手牌：1张1万
   - 副牌：3张1万（碰）→ 加杠后变成4张1万（杠）
   - 总共：1张（手牌）+ 4张（杠）= 5张（不是4张）

### 正确理解

根据麻将规则：
- **碰**：手牌2张 + 别人打出1张 = 3张（不是根）
- **加杠**：碰3张 + 手牌1张 = 4张（是根）
- **直杠**：手牌3张 + 别人打出1张 = 4张（是根）
- **暗杠**：手牌4张 = 4张（是根）

所以，**手牌加副牌有4张一样的也算根**，包括：
1. 手牌中有1张，副牌中有3张（碰），然后加杠 → 总共4张（是根）
2. 手牌中有3张，副牌中有1张（别人打出），直杠 → 总共4张（是根）
3. 手牌中有4张，暗杠 → 总共4张（是根）

### 当前实现问题

当前实现只统计：
- 手牌中的牌
- 杠（4张）

**没有统计碰（3张）**，所以如果手牌中有1张，副牌中有3张（碰），当前实现会：
- 手牌：1张 → 不是根
- 副牌：碰3张 → 不是根（因为碰只有3张，不是4张）
- 总共：4张 → **但当前实现会漏掉这种情况**

### 修复方案

需要统计**所有可见牌**（手牌 + 碰 + 杠），然后检查是否有4张相同的牌：

```rust
// 统计手牌中的牌
for (tile, &count) in hand.tiles_map() {
    tile_counts[idx] += count;
}

// 统计已碰/杠的牌
for meld in melds {
    match meld {
        Meld::Triplet { tile } => {
            // 碰：3 张相同的牌
            tile_counts[idx] += 3;
        }
        Meld::Kong { tile, .. } => {
            // 杠：4 张相同的牌
            tile_counts[idx] += 4;
        }
    }
}

// 统计计数为 4 的张数（即为根的总数）
for &count in &tile_counts {
    if count == 4 {
        root_count += 1;
    }
}
```

这样，如果手牌中有1张1万，副牌中有3张1万（碰），总共4张1万，就会算1个根。

